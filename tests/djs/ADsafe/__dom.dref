weak (~lNodes         : { Arr(Ref(~lNode)) | (packed v)} > lArrPro)
weak (~lChecked       : { Arr(Bool)         | (packed v)} > lArrPro)
weak (~lClassNames    : { Arr(Str)          | (packed v)} > lArrPro)
weak (~lADsafeMarks   : { Arr(Str)          | (packed v)} > lArrPro)
weak (~lNames         : { Arr(Str)          | (packed v)} > lArrPro)
weak (~lValues        : Arr(Str)  > lArrPro)
weak (~lOffsetHeights : { Arr(Num)          | (packed v)} > lArrPro)
weak (~lOffsetWidths  : { Arr(Num)          | (packed v)} > lArrPro)
weak (~lStyles        : Arr(Str)  > lArrPro)

weak (~lEvent     : {
  type_           : Str,
  target          : Ref(~lNode),    (* could also be Ref(~lEventTarget) *)
  cancelBubble    : Bool,
  stopPropagation : (this: Ref(~lEvent))-> Top,
  bubble          : (this: Ref(~lEvent))-> Top,
  preventDefault  : (this: Ref(~lEvent)) -> Top,
  srcElement      : Ref(~lNode),
  key             : Str, 
  altKey          : Bool,
  ctrlKey         : Bool,
  shiftKey        : Bool,
  that            : Ref(~lBunch),
  _               : Bot
} > lObjPro)

weak (~lEventTarget: { } > lObjPro)

weak (~lSelector : { Dict |
  (*op             : Str*)
  (and 
    (has v "op") ({(or  (= v "empty_") 
                        (= v "plus") 
                        (= v "greater") 
                        (= v "pound") 
                        (= v "slash") 
                        (= v "star"))
                  } (sel v "op"))
    (implies (has v "name") (Str (sel v "name"))))
} > lObjPro)
 
weak (~lRange : {
  text: Str,
  expand: (this:Ref(~lRange), Str) -> Bool
} > lObjPro)
  
weak (~lQuery: { Arr(Ref(~lSelector)) | (packed v) } > lArrPro)

weak (~lBunches: {Arr(Ref(~lBunch))|(packed v)} > lArrPro)

weak (~lBunch    : {
  "___nodes___"  : Ref(~lNodes),
  "___star___"   : Bool,
  _              : Bot    (* Needed to inherit fields from prototype *)
} > lBunchProto)

weak (~lStyle : {
    visibility   : Str,
    cssFloat     : Str,
    styleFloat   : Str
} > lObjPro)

weak (~lSelection: { createRange: () -> Ref(~lRange) }  > lObjPro) 


weak (~lNode: {
    getComputedStyle     : (this: Ref(~lNode), node : Ref(~lNode), str  : Str) -> Ref(~lStyle),
    currentStyle         : Ref(~lStyle),
    style                : Ref(~lStyle),
    firstChild           : Ref(~lNode),
    nextSibling          : Ref(~lNode),
    parentNode           : Ref(~lNode),
    parent               : Ref(~lNode),
    getParent            : (this: Ref(~lNode)) -> Ref(~lNode),
    childNodes           : Ref(~lNodes),
    change               : Ref(~lEvent),
    "___ on ___"         : Ref(~lEvent),
    "___adsafe root___"  : Str,
    "_adsafe mark_"      : Str,
    tagName              : Str,
    className            : Str,
    name                 : Str,
    nodeName             : Str,
    nodeValue            : Str,
    value                : Str,     (*XXX: This might break stuff *)
    title                : Str,
    disabled             : Bool,
    checked              : Bool,
    offsetHeight         : Num,
    offsetWidth          : Num,
    selectionStart       : Int,
    selectionEnd         : Int,
    autocomplete         : Str,
    fire                 : (NotUndef) -> Top,
    blur                 : (this: Ref(~lNode)) -> Top,
    cloneNode            : (this: Ref(~lNode), deep:Bool) -> Ref(~lNode),
    removeChild          : (this: Ref(~lNode), Ref(~lNode)) -> Top,
    removeElement        : (this: Ref(~lNode), Ref(~lNode)) -> Top,
    appendChild          : (this: Ref(~lNode), Ref(~lNode)) -> Top,
    replaceChild         : (this: Ref(~lNode), Ref(~lNode), Ref(~lNode)) -> Top,
    insertBefore         : (this: Ref(~lNode), Ref(~lNode), Ref(~lNode)) -> Top,
    addEventListener     : (this: Ref(~lNode), Str, (Ref(~lEvent)) -> Top, Bool) -> Top,
    focus                : () -> Top,   
    select               : (this: Ref(~lNode)) -> Top,   
    createTextRange      : () -> Ref(~lRange), 
    getElementsByTagName : [;L;] (this: Ref(~lNode), name : Str) / () -> 
                              Ref(L) / (L: {Arr(Ref(~lNode))|(packed v)} > lArrPro)
  } > lObjPro)

weak (~lDocument   : {
    defaultView    : Ref(~lNode),
    selection      : Ref(~lSelection),
    getElementById : (this: Top, s : Str) -> Ref(~lNode),
    createDocumentFragment : (this:Ref(~lDocument)) -> Ref(~lNode),
    createElement  : (this: Ref(~lDocument), s: Str) -> Ref(~lNode),
    createTextNode : (this: Ref(~lDocument), s: Str) -> Ref(~lNode)
  } > lObjPro)

weak (~lDom: { 
    append: (Ref(~lBunch)) -> Ref(~lDom),
    combine: (Ref(~lBunches)) -> Ref(~lBunch),
    count: () -> Int,
    ephemeral: (Ref(~lBunch)) -> Ref(~lDom),
    fragment: (Ref(~lBunch)) -> Ref(~lBunch),
    prepend: (Ref(~lBunch)) -> Ref(~lDom), 
    q: (Ref(text)) -> Ref(~lBunch),
    remove: () -> Top,
    row: (Top) -> Ref(~lBunch),
    tag_: (tag_: Str, type_: Str, name: Str) -> Ref(~lBunch),
    text:{( and 
      (v:: (text: Str) / (lT: {Arr(Str)|(packed v)} > lArrPro) -> Top / sameType)
      (v:: (text: Ref(lT)) / (lT: {Arr(Str)|(packed v)} > lArrPro) -> Top / sameType)
    )}
}  > lObjPro) 
